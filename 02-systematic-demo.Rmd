
\newpage

# Systematic sampling: demo {#sysdemo}

`r ifelse(book_format == "html" & with_watermark, "<div class='watermark'>DRAFT</div>", "")`

Now let's see what sampling grid spacing is the closest to a sampling size of `r round(n10)` plots. We will start with <txt-green>systematic sampling</txt-green> to account for the additional constraint on grid spacing, and afterwards we will make a simple random sampling that matches the same number of plots.

::::::{.infobox data-latex=""}

To practice R code we will process by try and error. We will start with a rather large grid spacing, based on a simple cross-multiplication and then reproduce the code for smaller grids until we reach a number of plots close to our budget constraint and an expected precision of 10%. 

::::::

The new land fits more or less in a 90 x 90 km square, meaning that if we were to place a sampling plot at the center of each square of a 1 km grid we would have 90 * 90 = `r 90^2` sampling plots. Similarly a 4 km grid would give us approximately (90 / 5)^2 = `r (90/5)^2` plots. This is close to the number of plots for 10% precision on AGB so we will start there.

The `sf` package contains the function `st_make_grid()` to create random and grid points within an existing polygon.  Let's make the grid. We have the `sf_admin` shapefile that contains the administrative boundary of `r newland_name` and can be used as a canvas for the grid. 

:::::::{.infobox data-latex=""}

We will also offset the grid starting point 1 km South and 1 km West of the land most Southern and Western point to avoid having too many plots at the edge of the land. This is a precaution specific for this exercise, as ```r newland_name``` shape is close to a square, and may not be needed in a real country! The `offset` is calculated based on the land cover shapefile bounding box calculated with `st_bbox()`.

```{r offset}

offset <- st_bbox(sf_lc)[c("xmin", "ymin")] + c(-1000, -1000)

```

:::::::

\  

## Create grid points {-}

To make the grid we use the option `what = "polygon"`...

```{r grid5}

sf_grid5 <- st_make_grid(sf_lc, cellsize = c(5000, 5000), what = "polygons", offset = offset) %>%
  st_intersection(sf_admin) %>%
  st_as_sf()

```

... And to make points we change the option to `what = "center"` (replace `"center"` with `"corner"` to have the points at the grid intersections). We use `st_intersection()` to reduce the grid to our 'country' boundaries and the function `st_as_sf()` converts the result of the intersection to an sf object. 

```{r points5}

sf_points5 <- st_make_grid(sf_lc, cellsize = c(5000, 5000), what = "centers", offset = offset) %>%
  st_intersection(sf_admin) %>%
  st_as_sf()

```

\  

After that, we overlap the point grid with the land cover layer with `st_join()` to assign land cover to each plot. We like to order our land cover code `lc` to appear in a certain order in maps. To follow the order of the land cover numerical ID `lc_id` we use the function `fct_reorder` from the tidyverse package `forcats`.

```{r plot5}

sf_plot5 <- sf_points5 %>%
  st_join(sf_lc) %>%
  mutate(lc = fct_reorder(lc, lc_id)) %>%
  filter(!is.na(lc))

```


\  

## Visualize {-}
 
We can visualize the grid with the following code based on the `ggplot2` package and its `geom_sf()` function to display `sf` objects. we have a custom color palette `pal` for ```r newland_name``` land covers.

```{r ggplot5}

ggplot() +
  geom_sf(data = sf_lc, aes(fill = lc), color = NA) +
  geom_sf(data = sf_plot5, aes(fill = lc), shape = 21) +
  geom_sf(data = sf_grid5, fill = NA, col = "red", size = 0.6) +
  geom_sf(data = sf_admin, fill= NA) +
  scale_fill_manual(values = pal) +
  labs(fill = "", color = "") +
  theme_void()

```

It's looking good!

\  

## Calculate the number of plot per land cover class {-}

To calculate the number of plot in each forest type and the total we can use `group_by()` and `summarise()` again, and we first convert our `sf` object to a tibble to get rid of the spatial information. 

```{r nplot5}

nplot5 <- sf_plot5 %>%
  as_tibble() %>%
  group_by(lc) %>%
  summarise(n = n())
nplot5 

```

Finally, we need to remove non-forest categories with `filter()` and sum up the remaining number of plots.

```{r nplot5_total}

nplot5_total <- nplot5 %>%
  filter(!(lc %in% c("WA", "NF"))) %>%
  summarise(n = sum(n))
nplot5_total

```

\  

While we can afford this sampling size, its expected precision is closer to 15% than our target 10%. We can try to intensify a bit to increase our precision. In our very first approximation we didn't account for the fact that a good proportion of the land is non-forest. In the next session you will prepare grids of 4 and 3 km width and calculate the number of forested plots.

\  

