

# Uneven Systematic Sampling

In the NFI technical module 3 on sampling, we have seen that systematic sampling are popular for their increased precision and low auto-correlation compared to simple random sampling. We have also seen that their main caveat is that a systematic sample is based on only one randomization. One way to avoid this limitation is to create an <txt-green>uneven systematic sampling</txt-green>. 

An uneven systematic sample starts with the same grid as a systematic sample, but instead of placing plots at the center or corner of the grid, we allocate them randomly inside each square of the grid. 

We will demonstrate the command for the 5 x 5 km grid and let you practice with the 4 x 4 km grid that we have selected for ```r newland_name```'s NFI. For making random points within a grid, we will use the function `st_sample()`, but this time we will apply it to the grid polygons and the size of the sample is 1 but repeated for each points in the grid.

```{r uneven5}

set.seed(10)
sf_points_uneven <- st_sample(x = sf_grid5, size = rep(1, nrow(as_tibble(sf_points5))))

```

Same as before, we can overlay the results with the land cover shapefile to see how many plots would fall on forests.

```{r uneven5-plot}

sf_plot_uneven <- sf_points_uneven %>%
  st_as_sf() %>%
  st_join(sf_lc) %>%
  mutate(lc = fct_reorder(lc, lc_id)) %>%
  filter(!is.na(lc))

```

Then a quick map is always a good idea to see if everything looks at it should. In this case, we should not see more than one pot in each grid square.

```{r uneven5-map}

ggplot() +
  geom_sf(data = sf_lc, aes(fill = lc), color = NA) +
  geom_sf(data = sf_plot_uneven, aes(fill = lc), shape = 21) +
  geom_sf(data = sf_grid5, fill = NA, col = "red") +
  geom_sf(data = sf_admin, fill = NA) +
  scale_fill_manual(values = pal) +
  labs(fill = "", color = "") +
  theme_void()

```


**Your turn! Create uneven systematic samples based on the 4 x 4 km grid.**

- First you need to create the 4 x 4 km grid. Have a look at the section 2 for code block if you don't remember the function inputs.

```{r grid4-cons, eval=F, class.source="Rchunk-cons"}

# Console
sf_grid4 <- st_make_grid(sf_lc, cellsize = c(___, ___), what = ___, offset = offset) %>%
  st_intersection(sf_admin)

```

```{r grid4-sol, class.source="Rchunk-sol", Rout = "Rout-sol"}

sf_grid4 <- st_make_grid(sf_lc, cellsize = c(5000, 5000), what = "polygons", offset = offset) %>%
  st_intersection(sf_admin)

```


**TBD**

- Create the points, choose whatever seed number you want:

```{r unevenpoints-cons, eval=F, class.source="Rchunk-cons"}

## Console
set.seed(10)
sf_points_rd2 <- st_sample(x = ___, size = ___) %>%
  st_as_sf()

```

```{r unevenpoints-sol, class.source="Rchunk-sol", class.output="Rout-sol"}

set.seed(100)
sf_points_rd2 <- st_sample(x = sf_lc, size = nplot3_total$n) %>%
  st_as_sf()

```

- Add the land cover information:

```{r unevenplot-cons, eval=F, class.source="Rchunk-cons"}

## Console
sf_plot_rd2 <- sf_points_rd2 %>%
  st_join(___) %>%
  mutate(lc = fct_reorder(lc, ___)) %>%
  filter(___)

```

```{r unevenplot-sol, class.source="Rchunk-sol", Rout="Rout-sol"}

sf_plot_rd2 <- sf_points_rd2 %>%
  st_join(sf_lc) %>%
  mutate(lc = fct_reorder(lc, lc_id)) %>%
  filter(!is.na(lc))

```

\  

- Show the plot locations on a map:

```{r unevenmap-cons, eval=F, class.source="Rchunk-cons"}

## Console
ggplot() +
  geom_sf(data = sf_lc, aes(fill = lc), color = NA) +
  geom_sf(data = ___, aes(fill = ___), shape = 21) +
  scale_fill_manual(values = pal) +
  labs(___, ___) +
  theme_void()

```

```{r unevenmap-sol, class.source="Rchunk-sol", class.output="Rout-sol"}

ggplot() +
  geom_sf(data = sf_lc, aes(fill = lc), color = NA) +
  geom_sf(data = sf_plot_rd2, aes(fill = lc), shape = 21) +
  scale_fill_manual(values = pal) +
  labs(fill = "", color = "") +
  theme_void()

```

- Calculate the number of plots per land cover type:

```{r unevencount-cons, eval=F, class.source="Rchunk-cons"}

## Console
nplot_rd2 <- ___ %>%
  as_tibble() %>%
  group_by(___) %>%
  summarise(n = n())
nplot_rd2

```

```{r unevencount-sol, class.source="Rchunk-sol", class.output="Rout-sol"}

nplot_rd2 <- sf_plot_rd2 %>%
  as_tibble() %>%
  group_by(lc) %>%
  summarise(n = n())
nplot_rd2

```

\  

Well done! We will keep these results for later and move on with Uneven Systematic Sampling.

\  

