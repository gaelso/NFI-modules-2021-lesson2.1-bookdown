# Uneven Systematic Sampling {uneven}

In the NFI technical module 3 on sampling, we have seen that systematic sampling are popular for their increased precision and low auto-correlation compared to simple random sampling. We have also seen that their main caveat is that a systematic sample is based on only one randomization. One way to avoid this limitation is to create an <txt-green>uneven systematic sampling</txt-green>.

An uneven systematic sample starts with the same grid as a systematic sample, but instead of placing plots at the center or corner of the grid, we allocate them randomly inside each square of the grid.

 

## Demo {-}

We will demonstrate the R commands for the 5 x 5 km grid and let you practice with the 4 x 4 km grid that we have selected for `r newland_name`'s NFI. For making random points within a grid, we will use the function `st_sample()`, but this time we will apply it to the grid polygons and the size of the sample is 1 but repeated for each points in the grid.

```{r uneven5}

set.seed(10)
sf_points_uneven <- st_sample(x = sf_grid5, size = rep(1, nrow(sf_points5)))

```

Same as before, we can overlay the results with the land cover shapefile to see how many plots would fall on forests.

```{r uneven5-plot}

sf_plot_uneven <- sf_points_uneven %>%
  st_as_sf() %>%
  st_join(sf_lc) %>%
  mutate(lc = fct_reorder(lc, lc_id)) %>%
  filter(!is.na(lc))

```

Then a quick map is always a good idea to see if everything looks at it should. In this case, we should not see more than one pot in each grid square.

```{r uneven5-map}

ggplot() +
  geom_sf(data = sf_lc, aes(fill = lc), color = NA) +
  geom_sf(data = sf_grid5, fill = NA, col = "red") +
  geom_sf(data = sf_plot_uneven, aes(fill = lc), shape = 21) +
  geom_sf(data = sf_admin, fill = NA) +
  scale_fill_manual(values = pal) +
  labs(fill = "", color = "") +
  theme_void()

```


## Create uneven systemic sampling for the 4 x 4 km grid {-}

**Your turn! Create an uneven systematic sample based on the 4 x 4 km grid.**

-   First you need to create the 4 x 4 km grid. Have a look at the section \@ref{sysdemo} for code block if you don't remember the function inputs, and adpat it to the 4 x 4 km grid.

```{r grid4-cons, eval=F, class.source="Rchunk-cons"}

# Console
sf_grid4 <- st_make_grid(sf_lc, cellsize = c(___, ___), what = ___, offset = offset) %>%
  st_intersection(sf_admin)

```

```{r grid4-sol, class.source="Rchunk-sol", Rout = "Rout-sol"}

sf_grid4 <- st_make_grid(sf_lc, cellsize = c(4000, 4000), what = "polygons", offset = offset) %>%
  st_intersection(sf_admin)

```

-   Create the points. We have just created the grids canvas `sf_grid4` and we have already created the grid points `sf_points4` in the section \@ref(sys4). Keep the seed 10 to have comparable results with all the users of this lesson.

NB: This operation is calculation intensive and may take a few minutes to complete.

```{r unevenpoints-cons, eval=F, class.source="Rchunk-cons"}

## Console
set.seed(10)
sf_points4_uneven <- st_sample(x = ___, size = ___) %>%
  st_as_sf()

```

```{r unevenpoints-sol, class.source="Rchunk-sol", class.output="Rout-sol"}

set.seed(10)
sf_points4_uneven <- st_sample(x = sf_grid4, size = rep(1, nrow(sf_points4))) %>%
  st_as_sf()

```

-   Add the land cover information:

```{r unevenplot-cons, eval=F, class.source="Rchunk-cons"}

## Console
sf_plot4_uneven <- ___ %>%
  ___(___) %>%
  ___(lc = fct_reorder(lc, ___)) %>%
  ___(___)

```

```{r unevenplot-sol, class.source="Rchunk-sol", Rout="Rout-sol"}

sf_plot4_uneven <- sf_points4_uneven %>%
  st_join(sf_lc) %>%
  mutate(lc = fct_reorder(lc, lc_id)) %>%
  filter(!is.na(lc))

```

 

-   Show the plot locations on a map with a `ggplot()`:

```{r unevenmap-cons, eval=F, class.source="Rchunk-cons"}

## Console
##

```

```{r unevenmap-cons2, eval=F, class.source="Rchunk-cons"}

## Tip
ggplot() +
  geom_sf(data = sf_lc, aes(fill = lc), color = NA) +
  geom_sf(data = ___, fill = NA, col = "red") +
  geom_sf(data = ___, aes(fill = lc), shape = 21) +
  geom_sf(data = ___, fill = NA) +
  scale_fill_manual(values = ___) +
  ___(fill = "", color = "") +
  theme_void()

```

```{r unevenmap-sol, class.source="Rchunk-sol", class.output="Rout-sol"}

## Solution
ggplot() +
  geom_sf(data = sf_lc, aes(fill = lc), color = NA) +
  geom_sf(data = sf_grid4, fill = NA, col = "red") +
  geom_sf(data = sf_plot4_uneven, aes(fill = lc), shape = 21) +
  geom_sf(data = sf_admin, fill = NA) +
  scale_fill_manual(values = pal) +
  labs(fill = "", color = "") +
  theme_void()

```

 

-   Calculate the number of plots per land cover type:

```{r unevencount-cons, eval=F, class.source="Rchunk-cons"}

## Console
##

```

```{r unevencount-cons2, eval=F, class.source="Rchunk-cons"}

## Tips
nplot4_uneven <- ___ %>%
  as_tibble() %>%
  group_by(___) %>%
  summarise(n = n())
nplot4_uneven

```

```{r unevencount-sol, class.source="Rchunk-sol", class.output="Rout-sol"}

## Solution
nplot4_uneven <- sf_plot4_uneven %>%
  as_tibble() %>%
  group_by(lc) %>%
  summarise(n = n())
nplot4_uneven

```

 
Well done! We have one of the best possible simple sampling design, combining strengths of both systematic and random sampling.

\  

## Proportion of plots per forested land cover {-}

Let's compare how many plots fell in each land cover class of `r newland_name` (Table \@ref(tab:compa)). We can see that our three simple sampling methods gave similar plot allocation per land cover with plus or minus 3 points between their proportion and the area proportion of the land cover classes. 


```{r compa, echo=F}

simple_res <- area_lc %>%
  mutate(area_kha = round(as.numeric(area_ha) /1000, 2)) %>%
  select(-area_ha) %>%
  left_join(nplot4 %>% rename(n_sys4 = n), by = "lc") %>%
  left_join(nplot_rd %>% rename(n_rd = n), by = "lc") %>%
  left_join(nplot4_uneven %>% rename(n_un4 = n), by = "lc") %>%
  mutate(n_rd = replace_na(n_rd, 0)) %>%
  filter(lc %in% c("EV", "MD", "DD", "WL", "MG"))

simple_tot <- simple_res %>%
  summarise(across(where(is.numeric), sum)) %>%
  mutate(lc = "Total") %>% 
  select(lc, everything())
  
kab <- simple_res %>%
  mutate(
    p_area = as.numeric(round(area_kha / simple_tot$area_kha * 100)),
    p_sys4 = round(n_sys4 / simple_tot$n_sys4 * 100),
    p_rd   = round(n_rd / simple_tot$n_rd * 100),
    p_un4  = round(n_un4 / simple_tot$n_un4 * 100)
  ) %>%
  bind_rows(simple_tot %>% mutate(p_area = 100, p_sys4 = 100, p_rd = 100, p_un4 = 100)) %>%
  select(lc, area_kha, p_area, n_sys4, p_sys4, n_rd, p_rd, n_un4, p_un4)

kab_opt <- list(
  x = kab,
  caption = "Area and percentage of plots in each forest land cover.",
  col.names = c("Land cover", "Area", "perc.",  rep(c("# plots", "perc."), 3)),
  #align = "ccccccccccccc",
  booktabs = TRUE,
  escape = F
  )

display_table() %>%
  add_header_above(c(
    " " = 1,
    "Area (kha)" = 2, 
    "Systematic sampling" = 2, 
    "Random sampling" = 2,
    "Uneven systematic sampling" = 2
  ))

```


This illustrate a few elements of sampling design presented in the **NFI eLearning Module 3: Sampling**: the differences between these sampling methods doesn't translate to major differences in plot allocation per land cover classes, but rather to statistical considerations.

::::::{.question data-latex=""}

Which of the following assertions are true?

1. Simple random sampling (SRS) is not suitable because you have no control over plot distribution.
1. **SRS is less suitable that systematic sampling methods as SRS plots have a higher chance of autocorrelation.**
1. **Systematic sampling consist of one sample, it only borrows SRS stats because they are considered conservative.**
1. **Uneven systematic sampling allows to use SRS statistical formulas while plot distributions still has less autocorrelation than SRS.**

::::::


::::::{.infobox data-latex=""}

Actually, a plot distribution proportional to land cover class relative areas is not always desirable. The main goal of sampling optimization is to get the best precision possible with the lowest number of plots to measure.  

From the sampling size formula for Simple Random Sampling (see section \@ref(size)), it is easy to understand that the the number of plots to measure increases with the variability of our main variable of interest (represented by its coefficient of variation $CV$).

If, for example, a population with a rather high $CV$ could be divided into two sub-populations with each a very low $CV$, we can intuitively understand that a small number of plot in each sub-population could give us a good precision. 

Similarly, if one of the sub-population has a higher $CV$ than the other, and **even if its relative area is smaller comparatively smaller**, allocating a higher number of plots to this sub-population will increase the overall precision.

For example, our simple sampling methods gave sample allocation to land cover classes more or less proportional to their relative areas. It means a very small number of plots in Mangrove forest and a high number of plots in Mixed-Deciduous forest. However the Aboveground biomass $CV$ for Mangrove may very well be much higher than in Mixed-Deciduous forest. In this case, a sampling strategy that would give more plots to Mangrove and less to Mixed-Deciduous forests would increase the overall precision of our Aboveground biomass and be more cost-efficient.

These strategies are called <txt-green>Stratified Sampling</txt-green> and wil be the main topic of another interactive lesson.

For now, we will continue with our best uneven systematic sampling design, based on 4 x 4 km grid.

::::::