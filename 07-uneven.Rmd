# Uneven Systematic Sampling {#uneven}

In the **NFI eLearning Module 3: Sampling**, we have seen that systematic sampling are popular for their increased precision and low auto-correlation compared to simple random sampling. We have also seen that their main caveat is that a systematic sampling is based on only one randomization. One way to avoid this limitation is to create an <txt-green>uneven systematic sampling</txt-green>.

An uneven systematic sample starts with the same grid as a systematic sampling, but instead of placing plots at the center or corner of the grid, we allocate them randomly inside each square of the grid.

\  

## Demo {-}

We will demonstrate the R commands for the 5 x 5 km grid and let you practice with the 4 x 4 km grid that we have selected for `r newland_name`'s NFI. For making random points within a grid, we will use the function `st_sample()`, but this time we will apply it to the grid polygons and the size of the sample is 1 but repeated for each points in the grid.

```{r uneven5}

set.seed(10)
sf_points_uneven <- st_sample(x = sf_grid5, size = rep(1, nrow(sf_points5)))

```

Same as before, we can overlay the results with the land cover shapefile to see how many plots would fall on forests.

```{r uneven5-plot}

sf_plot_uneven <- sf_points_uneven %>%
  st_as_sf() %>%
  st_join(sf_lc) %>%
  mutate(lc = fct_reorder(lc, lc_id)) %>%
  filter(!is.na(lc))

```

Then a quick map is always a good idea to see if everything looks at it should. In this case, we should not see more than one pot in each grid square.

```{r uneven5-map}

ggplot() +
  geom_sf(data = sf_lc, aes(fill = lc), color = NA) +
  geom_sf(data = sf_grid5, fill = NA, col = "red") +
  geom_sf(data = sf_plot_uneven, aes(fill = lc), shape = 21) +
  geom_sf(data = sf_admin, fill = NA) +
  scale_fill_manual(values = pal) +
  labs(fill = "", color = "") +
  theme_void()

```


## Create uneven systemic sampling for the 4 x 4 km grid {-}

**Your turn! Create an uneven systematic sample based on the 4 x 4 km grid.**

- First you need to create the 4 x 4 km grid. Have a look at the section \@ref(sysdemo) for code block if you don't remember the function inputs, and adapt it to the 4 x 4 km grid.

```{r grid4-cons, eval=F, class.source="Rchunk-cons"}

# Console
sf_grid4 <- st_make_grid(sf_lc, cellsize = c(___, ___), what = ___, offset = offset) %>%
  st_intersection(sf_admin)

```

```{r grid4-sol, class.source="Rchunk-sol", Rout = "Rout-sol"}

## Solution
sf_grid4 <- st_make_grid(sf_lc, cellsize = c(4000, 4000), what = "polygons", offset = offset) %>%
  st_intersection(sf_admin)

```

- Create the points. We have just created the grids canvas `sf_grid4` and we have already created the grid points `sf_points4` in the section \@ref(sys4). Keep the seed 10 to have comparable results with all the users of this lesson.

*NB: This operation is calculation intensive and may take a few minutes to complete.*

```{r unevenpoints-cons, eval=F, class.source="Rchunk-cons"}

## Console
set.seed(10)
sf_points4_uneven <- st_sample(x = ___, size = ___) %>%
  st_as_sf()

```

```{r unevenpoints-sol, class.source="Rchunk-sol", class.output="Rout-sol"}

## Solution
set.seed(10)
sf_points4_uneven <- st_sample(x = sf_grid4, size = rep(1, nrow(sf_points4))) %>%
  st_as_sf()

```

- Add the land cover information with `st_join()`.

```{r unevenplot-cons, eval=F, class.source="Rchunk-cons"}

## Console
sf_plot4_uneven <- ___ %>%
  ___(___) %>%
  ___(lc = fct_reorder(lc, ___)) %>%
  ___(___)

```

```{r unevenplot-sol, class.source="Rchunk-sol", Rout="Rout-sol"}

## Solution
sf_plot4_uneven <- sf_points4_uneven %>%
  st_join(sf_lc) %>%
  mutate(lc = fct_reorder(lc, lc_id)) %>%
  filter(!is.na(lc))

```

\  

- Show the plot locations on a map with a `ggplot()`.

```{r unevenmap-cons, eval=F, class.source="Rchunk-cons"}

## Console
##

```

```{r unevenmap-cons2, eval=F, class.source="Rchunk-cons"}

## Tip
ggplot() +
  geom_sf(data = sf_lc, aes(fill = lc), color = NA) +
  geom_sf(data = ___, fill = NA, col = "red") +
  geom_sf(data = ___, aes(fill = lc), shape = 21) +
  geom_sf(data = ___, fill = NA) +
  scale_fill_manual(values = ___) +
  ___(fill = "", color = "") +
  theme_void()

```

```{r unevenmap-sol, class.source="Rchunk-sol", class.output="Rout-sol"}

## Solution
ggplot() +
  geom_sf(data = sf_lc, aes(fill = lc), color = NA) +
  geom_sf(data = sf_grid4, fill = NA, col = "red") +
  geom_sf(data = sf_plot4_uneven, aes(fill = lc), shape = 21) +
  geom_sf(data = sf_admin, fill = NA) +
  scale_fill_manual(values = pal) +
  labs(fill = "", color = "") +
  theme_void()

```

\  

- And finally calculate the number of plots per land cover type.

```{r unevencount-cons, eval=F, class.source="Rchunk-cons"}

## Console
##

```

```{r unevencount-cons2, eval=F, class.source="Rchunk-cons"}

## Tip
nplot4_uneven <- ___ %>%
  as_tibble() %>%
  group_by(___) %>%
  summarise(n = n())
nplot4_uneven

```

```{r unevencount-sol, class.source="Rchunk-sol", class.output="Rout-sol"}

## Solution
nplot4_uneven <- sf_plot4_uneven %>%
  as_tibble() %>%
  group_by(lc) %>%
  summarise(n = n())
nplot4_uneven

```

Â 
Well done! We have one of the best possible simple sampling design, combining strengths of both systematic and random sampling.

\  

## Proportion of plots per forest land cover {-}

Let's compare how many plots fell in each land cover class of `r newland_name` for our three "simple" sampling methods (Table \@ref(tab:compa)). We can see that our three simple sampling methods gave similar plot allocation per land cover. There is plus or minus 3 points between their proportion and the area proportion of the land cover classes. 


```{r compa, echo=F}

simple_res <- area_lc %>%
  mutate(area_kha = round(as.numeric(area_ha) /1000, 2)) %>%
  select(-area_ha) %>%
  left_join(nplot4 %>% rename(n_sys4 = n), by = "lc") %>%
  left_join(nplot_rd %>% rename(n_rd = n), by = "lc") %>%
  left_join(nplot4_uneven %>% rename(n_un4 = n), by = "lc") %>%
  mutate(n_rd = replace_na(n_rd, 0)) %>%
  filter(lc %in% c("EV", "MD", "DD", "WL", "MG"))

simple_tot <- simple_res %>%
  summarise(across(where(is.numeric), sum)) %>%
  mutate(lc = "Total") %>% 
  select(lc, everything())
  
kab <- simple_res %>%
  mutate(
    p_area = as.numeric(round(area_kha / simple_tot$area_kha * 100)),
    p_sys4 = round(n_sys4 / simple_tot$n_sys4 * 100),
    p_rd   = round(n_rd / simple_tot$n_rd * 100),
    p_un4  = round(n_un4 / simple_tot$n_un4 * 100)
  ) %>%
  bind_rows(simple_tot %>% mutate(p_area = 100, p_sys4 = 100, p_rd = 100, p_un4 = 100)) %>%
  select(lc, area_kha, p_area, n_sys4, p_sys4, n_rd, p_rd, n_un4, p_un4)

kab_opt <- list(
  x = kab,
  caption = "Area and percentage of plots in each forest land cover.",
  col.names = c("Land cover", "Area", "perc.",  rep(c("# plots", "perc."), 3)),
  #align = "ccccccccccccc",
  booktabs = TRUE,
  escape = F
  )

if (book_format %in% c("html", "latex")) {
  
  display_table() %>%
  add_header_above(c(
    " " = 1,
    "Area (kha)" = 2, 
    "Systematic sampling" = 2, 
    "Random sampling" = 2,
    "Uneven systematic sampling" = 2
  ))

} else {
  
  display_table()
  
}

```


Let's refer back to the **NFI eLearning Module 3: Sampling**. The differences between these sampling methods doesn't translate to major differences in plot allocation per land cover classes, but rather to statistical considerations.

::::::{.question data-latex=""}

Which of the following assertions are true?

1. Simple random sampling (SRS) is not suitable because you have no control over plot distribution.
1. **SRS is less suitable that systematic sampling methods as SRS plots have a higher chance of autocorrelation.**
1. **Systematic sampling consist of one sample, it only borrows SRS stats because they are considered conservative.**
1. **Uneven systematic sampling allows to use SRS statistical formulas and plot distribution has less autocorrelation than SRS.**

::::::


